{
  "version": 3,
  "file": "/Users/eli/projects/draw/build/javascript/main.min.js",
  "sources": [
    "../../node_modules/grunt-requirejs/node_modules/almond/almond.js",
    "event.js",
    "globals.js",
    "class.js",
    "section.js",
    "tapHandler.js",
    "sections/login.js",
    "helpers.js",
    "dataBacking/baseBacking.js",
    "vendor/db.js",
    "dataBacking/indexedDBBacking.js",
    "dataBacking/webSQLBacking.js",
    "data.js",
    "templates/fileList.js",
    "components/drawCanvas.js",
    "components/manipulateCanvas.js",
    "components/thumbnail.js",
    "sections/fileList.js",
    "sections/draw.js",
    "managers/files.js",
    "sections/main.js",
    "managers/login.js",
    "main.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7ZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/DA,ADgEA;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtRA,ADuRA;ACtRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA,AD+BA;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA,AD+IA;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrmBA,ADsmBA;ACrmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/IA,ADgJA;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA,ADmBA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtLA,ADuLA;ACtLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACniBA,ADoiBA;ACniBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA,AD6EA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA,AD+DA;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "sourcesContent": [
    "\n/**\n * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/jrburke/almond for details\n */\n//Going sloppy to avoid 'use strict' string cost, but strict practices should\n//be followed.\n/*jslint sloppy: true */\n/*global setTimeout: false */\n\nvar requirejs, require, define;\n(function (undef) {\n    var main, req, makeMap, handlers,\n        defined = {},\n        waiting = {},\n        config = {},\n        defining = {},\n        hasOwn = Object.prototype.hasOwnProperty,\n        aps = [].slice;\n\n    function hasProp(obj, prop) {\n        return hasOwn.call(obj, prop);\n    }\n\n    /**\n     * Given a relative module name, like ./something, normalize it to\n     * a real name that can be mapped to a path.\n     * @param {String} name the relative name\n     * @param {String} baseName a real name that the name arg is relative\n     * to.\n     * @returns {String} normalized name\n     */\n    function normalize(name, baseName) {\n        var nameParts, nameSegment, mapValue, foundMap,\n            foundI, foundStarMap, starI, i, j, part,\n            baseParts = baseName && baseName.split(\"/\"),\n            map = config.map,\n            starMap = (map && map['*']) || {};\n\n        //Adjust any relative paths.\n        if (name && name.charAt(0) === \".\") {\n            //If have a base name, try to normalize against it,\n            //otherwise, assume it is a top-level require that will\n            //be relative to baseUrl in the end.\n            if (baseName) {\n                //Convert baseName to array, and lop off the last part,\n                //so that . matches that \"directory\" and not name of the baseName's\n                //module. For instance, baseName of \"one/two/three\", maps to\n                //\"one/two/three.js\", but we want the directory, \"one/two\" for\n                //this normalization.\n                baseParts = baseParts.slice(0, baseParts.length - 1);\n\n                name = baseParts.concat(name.split(\"/\"));\n\n                //start trimDots\n                for (i = 0; i < name.length; i += 1) {\n                    part = name[i];\n                    if (part === \".\") {\n                        name.splice(i, 1);\n                        i -= 1;\n                    } else if (part === \"..\") {\n                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {\n                            //End of the line. Keep at least one non-dot\n                            //path segment at the front so it can be mapped\n                            //correctly to disk. Otherwise, there is likely\n                            //no path mapping for a path starting with '..'.\n                            //This can still fail, but catches the most reasonable\n                            //uses of ..\n                            break;\n                        } else if (i > 0) {\n                            name.splice(i - 1, 2);\n                            i -= 2;\n                        }\n                    }\n                }\n                //end trimDots\n\n                name = name.join(\"/\");\n            } else if (name.indexOf('./') === 0) {\n                // No baseName, so this is ID is resolved relative\n                // to baseUrl, pull off the leading dot.\n                name = name.substring(2);\n            }\n        }\n\n        //Apply map config if available.\n        if ((baseParts || starMap) && map) {\n            nameParts = name.split('/');\n\n            for (i = nameParts.length; i > 0; i -= 1) {\n                nameSegment = nameParts.slice(0, i).join(\"/\");\n\n                if (baseParts) {\n                    //Find the longest baseName segment match in the config.\n                    //So, do joins on the biggest to smallest lengths of baseParts.\n                    for (j = baseParts.length; j > 0; j -= 1) {\n                        mapValue = map[baseParts.slice(0, j).join('/')];\n\n                        //baseName segment has  config, find if it has one for\n                        //this name.\n                        if (mapValue) {\n                            mapValue = mapValue[nameSegment];\n                            if (mapValue) {\n                                //Match, update name to the new value.\n                                foundMap = mapValue;\n                                foundI = i;\n                                break;\n                            }\n                        }\n                    }\n                }\n\n                if (foundMap) {\n                    break;\n                }\n\n                //Check for a star map match, but just hold on to it,\n                //if there is a shorter segment match later in a matching\n                //config, then favor over this star map.\n                if (!foundStarMap && starMap && starMap[nameSegment]) {\n                    foundStarMap = starMap[nameSegment];\n                    starI = i;\n                }\n            }\n\n            if (!foundMap && foundStarMap) {\n                foundMap = foundStarMap;\n                foundI = starI;\n            }\n\n            if (foundMap) {\n                nameParts.splice(0, foundI, foundMap);\n                name = nameParts.join('/');\n            }\n        }\n\n        return name;\n    }\n\n    function makeRequire(relName, forceSync) {\n        return function () {\n            //A version of a require function that passes a moduleName\n            //value for items that may need to\n            //look up paths relative to the moduleName\n            return req.apply(undef, aps.call(arguments, 0).concat([relName, forceSync]));\n        };\n    }\n\n    function makeNormalize(relName) {\n        return function (name) {\n            return normalize(name, relName);\n        };\n    }\n\n    function makeLoad(depName) {\n        return function (value) {\n            defined[depName] = value;\n        };\n    }\n\n    function callDep(name) {\n        if (hasProp(waiting, name)) {\n            var args = waiting[name];\n            delete waiting[name];\n            defining[name] = true;\n            main.apply(undef, args);\n        }\n\n        if (!hasProp(defined, name) && !hasProp(defining, name)) {\n            throw new Error('No ' + name);\n        }\n        return defined[name];\n    }\n\n    //Turns a plugin!resource to [plugin, resource]\n    //with the plugin being undefined if the name\n    //did not have a plugin prefix.\n    function splitPrefix(name) {\n        var prefix,\n            index = name ? name.indexOf('!') : -1;\n        if (index > -1) {\n            prefix = name.substring(0, index);\n            name = name.substring(index + 1, name.length);\n        }\n        return [prefix, name];\n    }\n\n    /**\n     * Makes a name map, normalizing the name, and using a plugin\n     * for normalization if necessary. Grabs a ref to plugin\n     * too, as an optimization.\n     */\n    makeMap = function (name, relName) {\n        var plugin,\n            parts = splitPrefix(name),\n            prefix = parts[0];\n\n        name = parts[1];\n\n        if (prefix) {\n            prefix = normalize(prefix, relName);\n            plugin = callDep(prefix);\n        }\n\n        //Normalize according\n        if (prefix) {\n            if (plugin && plugin.normalize) {\n                name = plugin.normalize(name, makeNormalize(relName));\n            } else {\n                name = normalize(name, relName);\n            }\n        } else {\n            name = normalize(name, relName);\n            parts = splitPrefix(name);\n            prefix = parts[0];\n            name = parts[1];\n            if (prefix) {\n                plugin = callDep(prefix);\n            }\n        }\n\n        //Using ridiculous property names for space reasons\n        return {\n            f: prefix ? prefix + '!' + name : name, //fullName\n            n: name,\n            pr: prefix,\n            p: plugin\n        };\n    };\n\n    function makeConfig(name) {\n        return function () {\n            return (config && config.config && config.config[name]) || {};\n        };\n    }\n\n    handlers = {\n        require: function (name) {\n            return makeRequire(name);\n        },\n        exports: function (name) {\n            var e = defined[name];\n            if (typeof e !== 'undefined') {\n                return e;\n            } else {\n                return (defined[name] = {});\n            }\n        },\n        module: function (name) {\n            return {\n                id: name,\n                uri: '',\n                exports: defined[name],\n                config: makeConfig(name)\n            };\n        }\n    };\n\n    main = function (name, deps, callback, relName) {\n        var cjsModule, depName, ret, map, i,\n            args = [],\n            usingExports;\n\n        //Use name if no relName\n        relName = relName || name;\n\n        //Call the callback to define the module, if necessary.\n        if (typeof callback === 'function') {\n\n            //Pull out the defined dependencies and pass the ordered\n            //values to the callback.\n            //Default to [require, exports, module] if no deps\n            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;\n            for (i = 0; i < deps.length; i += 1) {\n                map = makeMap(deps[i], relName);\n                depName = map.f;\n\n                //Fast path CommonJS standard dependencies.\n                if (depName === \"require\") {\n                    args[i] = handlers.require(name);\n                } else if (depName === \"exports\") {\n                    //CommonJS module spec 1.1\n                    args[i] = handlers.exports(name);\n                    usingExports = true;\n                } else if (depName === \"module\") {\n                    //CommonJS module spec 1.1\n                    cjsModule = args[i] = handlers.module(name);\n                } else if (hasProp(defined, depName) ||\n                           hasProp(waiting, depName) ||\n                           hasProp(defining, depName)) {\n                    args[i] = callDep(depName);\n                } else if (map.p) {\n                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});\n                    args[i] = defined[depName];\n                } else {\n                    throw new Error(name + ' missing ' + depName);\n                }\n            }\n\n            ret = callback.apply(defined[name], args);\n\n            if (name) {\n                //If setting exports via \"module\" is in play,\n                //favor that over return value and exports. After that,\n                //favor a non-undefined return value over exports use.\n                if (cjsModule && cjsModule.exports !== undef &&\n                        cjsModule.exports !== defined[name]) {\n                    defined[name] = cjsModule.exports;\n                } else if (ret !== undef || !usingExports) {\n                    //Use the return value from the function.\n                    defined[name] = ret;\n                }\n            }\n        } else if (name) {\n            //May just be an object definition for the module. Only\n            //worry about defining if have a module name.\n            defined[name] = callback;\n        }\n    };\n\n    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {\n        if (typeof deps === \"string\") {\n            if (handlers[deps]) {\n                //callback in this case is really relName\n                return handlers[deps](callback);\n            }\n            //Just return the module wanted. In this scenario, the\n            //deps arg is the module name, and second arg (if passed)\n            //is just the relName.\n            //Normalize module name, if it contains . or ..\n            return callDep(makeMap(deps, callback).f);\n        } else if (!deps.splice) {\n            //deps is a config object, not an array.\n            config = deps;\n            if (callback.splice) {\n                //callback is an array, which means it is a dependency list.\n                //Adjust args if there are dependencies\n                deps = callback;\n                callback = relName;\n                relName = null;\n            } else {\n                deps = undef;\n            }\n        }\n\n        //Support require(['a'])\n        callback = callback || function () {};\n\n        //If relName is a function, it is an errback handler,\n        //so remove it.\n        if (typeof relName === 'function') {\n            relName = forceSync;\n            forceSync = alt;\n        }\n\n        //Simulate async callback;\n        if (forceSync) {\n            main(undef, deps, callback, relName);\n        } else {\n            //Using a non-zero value because of concern for what old browsers\n            //do, and latest browsers \"upgrade\" to 4 if lower value is used:\n            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:\n            //If want a value immediately, use require('id') instead -- something\n            //that works in almond on the global level, but not guaranteed and\n            //unlikely to work in other AMD implementations.\n            setTimeout(function () {\n                main(undef, deps, callback, relName);\n            }, 4);\n        }\n\n        return req;\n    };\n\n    /**\n     * Just drops the config on the floor, but returns req in case\n     * the config return value is used.\n     */\n    req.config = function (cfg) {\n        config = cfg;\n        if (config.deps) {\n            req(config.deps, config.callback);\n        }\n        return req;\n    };\n\n    /**\n     * Expose module registry for debugging and tooling\n     */\n    requirejs._defined = defined;\n\n    define = function (name, deps, callback) {\n\n        //This module may not have dependencies\n        if (!deps.splice) {\n            //deps is not an array, so probably means\n            //an object literal or factory function for\n            //the value. Adjust args.\n            callback = deps;\n            deps = [];\n        }\n\n        if (!hasProp(defined, name) && !hasProp(waiting, name)) {\n            waiting[name] = [name, deps, callback];\n        }\n    };\n\n    define.amd = {\n        jQuery: true\n    };\n}());\n\ndefine(\"almond\", function(){});\n",
    "\ndefine('event',[], function() {\n\n  function Event() {\n    this.init();\n  }\n\n  Event.prototype = {\n    listeners: null,\n\n    init: function() {\n      this.listeners = [];\n    },\n\n    addListener: function(event, callback) {\n      if (!this.listeners[event]) {\n        this.listeners[event] = [];\n      }\n\n      this.listeners[event].push(callback);\n    },\n\n    removeListener: function(event, callback) {\n      if (!this.listeners[event]) {\n        return false;\n      }\n\n      for(var i = 0; i < this.listeners[event].length; i++) {\n        if (this.listeners[event][i] == callback) {\n          this.listeners[event] = this.listeners[event].splice(i, 1);\n          return true;\n        }\n      }\n    },\n\n    trigger: function(event, data) {\n      if (!this.listeners[event]) {\n        return false;\n      }\n\n      function callListener(listener) {\n        setTimeout(function() {\n          listener(data);\n        }, 0);\n      }\n\n      for(var i = 0; i < this.listeners[event].length; i++) {\n        callListener(this.listeners[event][i]);\n      }\n\n      return true;\n    }\n  }\n\n  return new Event(); \n\n});",
    "\ndefine('globals',[], function() {\n  return {\n    isiOS: function() {\n      return this.hasDeviceType(\"iOS\");\n    },\n\n    isPC: function() {\n      return this.hasDeviceType(\"PC\");\n    },\n\n    isMac: function() {\n      return this.hasDeviceType(\"Mac\");\n    },\n\n    hasDeviceType: function(type) {\n      return this.getDeviceType().indexOf(type) !== -1;\n    },\n\n    getDeviceType: function() {\n      if (localStorage.deviceType) {\n        //return JSON.parse(localStorage.deviceType);\n      }\n\n      var devices = [];\n      var userAgent = navigator.userAgent;\n\n      if (userAgent.match(/OS 7/g)) {\n        devices.push(\"iOS\");\n\n        if (userAgent.match(/iPad/g)) {\n          devices.push(\"iPad\");\n          devices.push(\"tablet\");\n        }\n        else if (userAgent.match(/iPhone/g)) {\n          devices.push(\"iPhone\");\n          devices.push(\"phone\");\n        }\n      }\n      else if (userAgent.match(/Mac/g)) {\n        devices.push(\"Mac\");\n        devices.push(\"computer\");\n      }\n      else\n      {\n        devices.push(\"PC\");\n        devices.push(\"computer\");\n      }\n\n\n\n      localStorage.deviceType = JSON.stringify(devices);\n\n      return devices;\n    },\n\n    setHTMLDevices: function() {\n      var devices = this.getDeviceType();\n\n      var body = document.body;\n      body.className = devices.join(\" \");\n    }\n\n  }\n});",
    "\ndefine('class',[], function() {\n\t/* Simple Javascript inheritance by John Resig */\n\n\tvar initializing = false,\n\t\tfnTest = /xyz/.test(function() {\n\t\t\txyz;\n\t\t}) ? /\\b_super\\b/ : /.*/;\n\n\t// The base CClass implementation (does nothing)\n\tthis.Class = function() {};\n\n\t// Create a new CLass that inherits from this class\n\tClass.extend = function(prop) {\n\t\tvar _super = this.prototype;\n\n\t\t// Instantiate a base class (but only create the instance, don't run the consutrcutor)\n\t\tinitializing = true;\n\t\tvar prototype = new this();\n\t\tinitializing = false;\n\n\t\t// Copy the properties over onto the new prototype\n\t\tfor (var name in prop) {\n\t\t\t// Check if we're overwriting an existing function\n\t\t\tprototype[name] = typeof prop[name] == \"function\" && typeof _super[name] == \"function\" && fnTest.test(prop[name]) ?\n\t\t\t\t(function(name, fn) {\n\t\t\t\treturn function() {\t\t\t\t\n\t\t\t\t\tvar tmp = this._super;\n\n\t\t\t\t\t// Add a new ._super() method that is the same method\n\t\t\t\t\t// but on the super-class\n\t\t\t\t\tthis._super = _super[name];\n\n\t\t\t\t\t// The method only need to be bound temporarily, so we\n\t\t\t\t\t// remove it when we're done executing\n\n\t\t\t\t\tvar ret = fn.apply(this, arguments);\n\t\t\t\t\tthis._super = tmp;\n\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\t\t\t})(name, prop[name]) : prop[name];\n\t\t}\n\n\t\t// The dummy class constructor\n\n\t\tfunction Class() {\n\t\t\t// All construction is actually done in the init method\n\t\t\tif (!initializing && this.init)\n\t\t\t\tthis.init.apply(this, arguments);\n\t\t}\n\n\t\t// Populate our constructed prototype object\n\t\tClass.prototype = prototype;\n\n\t\t// Enforce the constructor to be what we expect\n\t\tClass.prototype.constructor = Class;\n\n\t\t// And make this class extendable\n\t\tClass.extend = arguments.callee;\n\n\t\treturn Class;\n\n\t};\n\n\treturn this.Class;\n});",
    "\ndefine('section',[\"class\"], function(Class) {\n\n\tvar Section = Class.extend({\n\t\tid: null,\n\t\telement: null,\n\n\t\tinit: function() {\n\t\t\tthis.element = document.getElementById(this.id);\n\t\t},\n\n\t\tshow: null,\n\t\thide: null,\n\n\t\tafterShow: function() {\n\t\t\tthis.element.style.display = \"block\";\n\t\t},\n\n\t\tafterHide: function() {\n\t\t\tthis.element.style.display = \"\";\n\t\t}\n\n\t});\n\n\treturn Section;\n});",
    "\ndefine('tapHandler',[], function() {\n  function TapHandler(element, options) {\n    this.init(element, options);\n  }\n\n  TapHandler.prototype = {\n    _element: null,\n    _options: null,\n\n    _distCutoff: 20,\n    _timeCutoff: 500,\n\n    // touch or mouse\n    _startType: null,\n    _startTouchId: null,\n    _startTime: null,\n    _startX: null,\n    _startY: null,\n\n    _startScale: null,\n\n    _lastX: null,\n    _lastY: null,\n\n    _lastScale: null,\n\n    // Object with x and why of where the element is on the page\n    _offset: null,\n\n    _inTouch: false,\n    _inGesture: false,\n\n    _ignoreGestures: false,\n\n    init: function(element, options) {\n      this._element = element;\n      this._options = options;\n\n      // Replace with binded events\n      this._move = this._move.bind(this);\n      this._end = this._end.bind(this);\n      this._gestureChange = this._gestureChange.bind(this);\n      this._gestureEnd = this._gestureEnd.bind(this);\n\n      this._offset = {\n        x: element.offsetLeft,\n        y: element.offsetTop\n      };\n\n      this._element.addEventListener(\"mousedown\", this._start.bind(this));\n      this._element.addEventListener(\"touchstart\", this._start.bind(this));\n      this._element.addEventListener(\"gesturestart\", this._gestureStart.bind(this));\n    },\n\n    ignoreGestures: function(value) {\n      this._ignoreGestures = value;\n    },\n\n\n    _start: function(e) {\n      //console.log(\"start called\");\n      if (e.touches) {\n        // start touch is the last touch\n        this._startTouchId = e.touches[e.touches.length - 1].identifier;\n      }\n\n      this._processEvent(e);\n\n      // Ignore these if we are currently gesturing\n      if (this._inGesture) {\n        return;\n      }\n\n      this._startType = \"mouse\";\n      if (e.touches) {\n        this._startType = \"touch\";\n        //console.log(e);\n\n      }\n\n      this._inTouch = true;\n\n\n      this._startTime = e.timeStamp;\n\n      this._startX = this._lastX = e.x;\n      this._startY = this._lastY = e.y;\n\n      //console.log(\"-start\", e.x, e.y);\n\n      if (this._options.start) {\n        this._options.start(e);\n      }\n\n      if (this._startType == \"touch\") {\n        document.addEventListener(\"touchmove\", this._move);\n        document.addEventListener(\"touchend\", this._end);\n      } else if (this._startType == \"mouse\") {\n        document.addEventListener(\"mousemove\", this._move);\n        document.addEventListener(\"mouseup\", this._end);\n      }\n    },\n\n    _move: function(e) {\n      this._processEvent(e);\n\n      this._lastX = e.x;\n      this._lastY = e.y;\n\n      if (this._options.move) {\n        this._options.move(e);\n      }\n    },\n\n    _end: function(e) {\n      /*\n        if e isn't set, end the handlers, call tap if it is within limits, call end\n      */\n\n      if (!e) {\n        this._endTouchHandlers();\n        if (this._options.end) {\n          this._options.end();\n        }\n\n        return;\n      }\n\n      // The event still has our start touch, it hasn't ended\n      if (e.touches && this._indexOfTouch(e, this._startTouchId) !== -1) {\n        return;\n      }\n\n      this._endTouchHandlers();\n      this._processEvent(e);\n\n      //console.log(\"-end\", e.x, e.y, this._startX, this._startY);\n\n\n      var dist = Math.sqrt(((e.x - this._startX) * (e.x - this._startX)) + ((e.y - this._startY) * (e.y - this._startY)));\n      //console.log(\"-dist\", dist);\n\n      if (dist < this._distCutoff && (e.timeStamp - this._startTime < this._timeCutoff)) {\n        if (this._options.tap) {\n          this._options.tap(e);\n        }\n      }\n\n      // It wasn't a tap, just an up\n      if (this._options.end) {\n        this._options.end(e);\n      }\n\n      this._inTouch = false;\n\n      // Keep mouse events from being called\n      if (e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n      }\n    },\n\n    _gestureStart: function(e) {\n      if (this._ignoreGestures) {\n        return;\n      }\n\n      this._inGesture = true;\n\n      // We need to end the touch\n      this._end();\n\n\n      this._processEvent(e);\n      this._processGesture(e);\n\n      this._startTime = e.timeStamp;\n\n      this._startX = this._lastX = e.x;\n      this._startY = this._lastY = e.y;\n\n      //console.log(\"gesture started\", this._startX, this._startY);\n\n      this._startScale = this._lastScale = e.scale;\n\n      document.addEventListener(\"gesturechange\", this._gestureChange);\n      document.addEventListener(\"gestureend\", this._gestureEnd);\n    },\n\n    _gestureChange: function(e) {\n      this._processEvent(e);\n      this._processGesture(e);\n\n      this._lastX = e.x;\n      this._lastY = e.y;\n      this._lastScale = e.scale;\n\n      //console.log(e.xFromLast, e.yFromLast);\n\n      this._lastScale = e.scale;\n\n      if (this._options.gesture) {\n        this._options.gesture(e);\n      }\n    },\n\n    _gestureEnd: function(e) {\n      this._processEvent(e);\n      this._processGesture(e);\n\n      document.removeEventListener(\"gesturechange\", this._gestureChange);\n      document.removeEventListener(\"gestureend\", this._gestureEnd);\n\n      this._inGesture = false;\n    },\n\n    // Unregister the regular touch handlers, used for when gestures start\n    _endTouchHandlers: function() {\n      if (this._startType == \"touch\") {\n        document.removeEventListener(\"touchmove\", this._move);\n        document.removeEventListener(\"touchend\", this._end);\n      } else if (this._startType == \"mouse\") {\n        document.removeEventListener(\"mousemove\", this._move);\n        document.removeEventListener(\"mouseup\", this._end);\n      }\n    },\n\n    // Given an e, add things like x and y regardless of touch or mouse\n    _processEvent: function(e) {\n      var index = -1;\n      // It's a touch\n      if (e.touches && e.touches.length > 0 && (index = this._indexOfTouch(e, this._startTouchId)) !== -1) {\n        // Use the last touch\n        e.x = e.touches[index].clientX;\n        e.y = e.touches[index].clientY;\n      } else if (e.clientX) {\n        // It's a click\n        e.x = e.clientX;\n        e.y = e.clientY;\n      } else if (e.pageX) {\n        // gesture events only get a layerx\n        e.x = e.pageX;\n        e.y = e.pageY;\n      } else {\n        // It's probably an end, there is no coords\n        e.x = this._lastX;\n        e.y = this._lastY;\n      }\n\n      e.distFromLeft = e.x - this._offset.x;\n      e.distFromTop = e.y - this._offset.y;\n\n      e.xFromLast = e.x - this._lastX;\n      e.yFromLast = e.y - this._lastY;\n    },\n\n    _processGesture: function(e) {\n      e.scaleFromLast = e.scale - this._lastScale;\n    },\n\n    _indexOfTouch: function(e, identifier) {\n      var index = -1;\n      if (e.touches && identifier) {\n        for (var i = 0; i < e.touches.length; i++) {\n          if (e.touches[i].identifier == identifier) {\n            index = i;\n            break;\n          }\n        }\n      }\n\n      return index;\n    }\n\n\n  };\n\n  return TapHandler;\n});",
    "\ndefine('sections/login',[\"event\", \"section\", \"tapHandler\"], function(Event, Section, TapHandler) {\n\n  var Login = Section.extend({\n    id: \"login\",\n\n    init: function() {\n      this._super();\n      console.log(\"login init\");\n      \n      var button = document.getElementById(\"loginbutton\");\n      new TapHandler(button, {tap: this._loginClicked.bind(this) });\n    },\n\n    _loginClicked: function() {\n      setTimeout(function() {\n        Event.trigger(\"login\");  \n      }, 400);\n    },\n\n    show: function() {\n      console.log(\"login shown\");\n    },\n\n    hide: function() {\n      console.log(\"login hidden\");\n    }, \n  });\n\n  return Login;\n\n});",
    "\ndefine('helpers',[], function() {\n  return {\n    parentEleWithClassname: function(ele, className) {\n      if (ele == null || !ele.classList) {\n        return false;\n      }\n\n      if (ele.classList.contains(className)) {\n        return ele;\n      }\n\n      return this.parentEleWithClassname(ele.parentNode, className);\n    },\n\n\n    screenToWorld: function(settings, x, y) {\n      return {\n        x: (x - settings.offsetX) / settings.scale,\n        y: (y - settings.offsetY) / settings.scale\n      };\n    },\n\n    worldToScreen: function(settings, x, y) {\n      return {\n        x: (x) * settings.scale + settings.offsetX,\n        y: (y) * settings.scale + settings.offsetY\n      };\n    },\n\n    getCurveControlPoints: function(knots) {\n\n      function getFirstControlPoints(rhs) {\n        var n = rhs.length;\n        var x = new Array(n); // Solution vector\n        var tmp = new Array(n); // Temp workspace\n\n        var b = 2.0;\n        x[0] = rhs[0] / b;\n\n        for (var i = 1; i < n; i++) { // Decomposition and forward substitution\n          tmp[i] = 1 / b;\n          b = (i < n - 1 ? 4 : 3.5) - tmp[i];\n          x[i] = (rhs[i] - x[i - 1]) / b;\n        }\n\n        for (var i = 1; i < n; i++) {\n          x[n - i - 1] -= tmp[n - i] * x[n - i]; // backsubstituion\n        }\n\n        return x;\n      };\n\n\n      var n = knots.length - 1;\n\n      var firstControlPoints = [];\n      var secondControlPoints = [];\n\n      if (n < 1) {\n        console.error(\"Must have at least two knots\");\n        return;\n      }\n\n      if (n == 1) {\n        // Special case: should be a line\n        firstControlPoints.push({});\n        firstControlPoints[0].x = (2 * knots[0].x + knots[1].x) / 3;\n        firstControlPoints[0].y = (2 * knots[0].y + knots[1].y) / 3;\n\n        secondControlPoints.push({});\n        secondControlPoints[0].x = 2 * firstControlPoints[0].x - knots[0].x;\n        secondControlPoints[0].y = 2 * firstControlPoints[0].y - knots[0].y;\n\n        return [{\n          first: firstControlPoints[0],\n          second: secondControlPoints[0]\n        }];\n      }\n\n      // Calculate first Bezier control points\n      // Right hand side vector\n      var rhs = new Array(n);\n\n\n      // Set right hand side X values\n      for (var i = 1; i < n - 1; ++i) {\n        rhs[i] = 4 * knots[i].x + 2 * knots[i + 1].x;\n      }\n\n      rhs[0] = knots[0].x + 2 * knots[1].x;\n      rhs[n - 1] = (8 * knots[n - 1].x + knots[n].x) / 2;\n\n      // Get first control points x-values\n      var x = getFirstControlPoints(rhs);\n\n      // Set right hand side Y values\n      for (var i = 1; i < n - 1; ++i) {\n        rhs[i] = 4 * knots[i].y + 2 * knots[i + 1].y;\n      }\n\n      rhs[0] = knots[0].y + 2 * knots[1].y;\n      rhs[n - 1] = (8 * knots[n - 1].y + knots[n].y) / 2;\n\n      // Get first control points Y-values\n      var y = getFirstControlPoints(rhs);\n\n      // Fill output arrays.\n      firstControlPoints = new Array(n);\n      secondControlPoints = new Array(n);\n\n      for (var i = 0; i < n; ++i) {\n        // First control point\n        firstControlPoints[i] = {\n          x: x[i],\n          y: y[i]\n        };\n\n        // Second control point\n        if (i < n - 1) {\n          secondControlPoints[i] = {\n            x: 2 * knots[i + 1].x - x[i + 1],\n            y: 2 * knots[i + 1].y - y[i + 1]\n          };\n        } else {\n          secondControlPoints[i] = {\n            x: (knots[n].x + x[n - 1]) / 2,\n            y: (knots[n].y + y[n - 1]) / 2\n          };\n        }\n      }\n\n      var controlPoints = new Array(n);\n      for (var i = 0; i < n; ++i) {\n        controlPoints[i] = {\n          first: firstControlPoints[i],\n          second: secondControlPoints[i]\n        }\n      }\n\n      return controlPoints;\n    },\n  };\n});",
    "\ndefine('dataBacking/baseBacking',[\"class\"], function(Class) {\n  var BaseBacking = Class.extend({\n    init: function() {\n      throw \"Do not use this class without extending it\";\n    },\n\n    getFiles: function(callback) {\n      console.error(\"Implement this function\");\n    },\n\n    getFileActions: function(fileId, callback) {\n      console.error(\"Implement this function\");\n    },\n\n    createFile: function(callback) {\n      console.error(\"Implement this function\");\n    },\n\n    renameFile: function(fileId, newFileName) {\n      console.error(\"Implement this function\");\n    },\n\n    deleteFile: function(fileId) {\n      console.error(\"Implement this function\");\n    },\n\n    addAction: function(fileId, action) {\n      console.error(\"Implement this function\");\n    },\n\n    removeAction: function(fileId, actionIndex) {\n      console.error(\"Implement this function\");\n    },\n\n    updateFileModified: function(fileId, timestamp) {\n      console.error(\"Implement this function\");\n    },\n\n    clearAll: function() {\n      console.error(\"Implement this function\");\n    },\n\n    _getGuid: function() {\n      return 'T^' + Date.now() + \"-\" + Math.round(Math.random() * 1000000);\n    },\n  });\n\n  return BaseBacking;\n});",
    "\ndefine('db',[], function() {\n    'use strict';\n    var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.oIndexedDB || window.msIndexedDB,\n        IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange,\n        transactionModes = {\n            readonly: 'readonly',\n            readwrite: 'readwrite'\n        };\n        \n    var hasOwn = Object.prototype.hasOwnProperty;\n\n    if ( !indexedDB ) {\n        console.warn('IndexedDB required');\n        return;\n    }\n\n    var defaultMapper = function (value) {\n        return value;\n    };\n\n    var CallbackList = function () {\n        var state,\n            list = [];\n\n        var exec = function ( context , args ) {\n            if ( list ) {\n                args = args || [];\n                state = state || [ context , args ];\n\n                for ( var i = 0 , il = list.length ; i < il ; i++ ) {\n                    list[ i ].apply( state[ 0 ] , state[ 1 ] );\n                }\n\n                list = [];\n            }\n        };\n\n        this.add = function () {\n            for ( var i = 0 , il = arguments.length ; i < il ; i ++ ) {\n                list.push( arguments[ i ] );\n            }\n\n            if ( state ) {\n                exec();\n            }\n\n            return this;\n        };\n\n        this.execute = function () {\n            exec( this , arguments );\n            return this;\n        };\n    };\n\n    var Deferred = function ( func ) {\n        var state = 'progress',\n            actions = [\n                [ 'resolve' , 'done' , new CallbackList() , 'resolved' ],\n                [ 'reject' , 'fail' , new CallbackList() , 'rejected' ],\n                [ 'notify' , 'progress' , new CallbackList() ],\n            ],\n            deferred = {},\n            promise = {\n                state: function () {\n                    return state;\n                },\n                then: function ( /* doneHandler , failedHandler , progressHandler */ ) {\n                    var handlers = arguments;\n\n                    return Deferred(function ( newDefer ) {\n                        actions.forEach(function ( action , i ) {\n                            var handler = handlers[ i ];\n\n                            deferred[ action[ 1 ] ]( typeof handler === 'function' ?\n                                function () {\n                                    var returned = handler.apply( this , arguments );\n\n                                    if ( returned && typeof returned.promise === 'function' ) {\n                                        returned.promise()\n                                            .done( newDefer.resolve )\n                                            .fail( newDefer.reject )\n                                            .progress( newDefer.notify );\n                                    }\n                                } : newDefer[ action[ 0 ] ]\n                            );\n                        });\n                    }).promise();\n                },\n                promise: function ( obj ) {\n                    if ( obj ) {\n                        Object.keys( promise )\n                            .forEach(function ( key ) {\n                                obj[ key ] = promise[ key ];\n                            });\n\n                        return obj;\n                    }\n                    return promise;\n                }\n            };\n\n        actions.forEach(function ( action , i ) {\n            var list = action[ 2 ],\n                actionState = action[ 3 ];\n\n            promise[ action[ 1 ] ] = list.add;\n\n            if ( actionState ) {\n                list.add(function () {\n                    state = actionState;\n                });\n            }\n\n            deferred[ action[ 0 ] ] = list.execute;\n        });\n\n        promise.promise( deferred );\n\n        if ( func ) {\n            func.call( deferred , deferred );\n        }\n\n        return deferred;\n    };\n\n    var Server = function ( db , name ) {\n        var that = this,\n            closed = false;\n\n        this.add = function( table ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n\n            var records = [];\n            for (var i = 0; i < arguments.length - 1; i++) {\n                records[i] = arguments[i + 1];\n            }\n\n            var transaction = db.transaction( table , transactionModes.readwrite ),\n                store = transaction.objectStore( table ),\n                deferred = Deferred();\n            \n            records.forEach( function ( record ) {\n                var req;\n                if ( record.item && record.key ) {\n                    var key = record.key;\n                    record = record.item;\n                    req = store.add( record , key );\n                } else {\n                    req = store.add( record );\n                }\n\n                req.onsuccess = function ( e ) {\n                    var target = e.target;\n                    var keyPath = target.source.keyPath;\n                    if ( keyPath === null ) {\n                        keyPath = '__id__';\n                    }\n                    Object.defineProperty( record , keyPath , {\n                        value: target.result,\n                        enumerable: true\n                    });\n                    deferred.notify();\n                };\n            } );\n            \n            transaction.oncomplete = function () {\n                deferred.resolve( records , that );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( records , e );\n            };\n            transaction.onabort = function ( e ) {\n                deferred.reject( records , e );\n            };\n            return deferred.promise();\n        };\n\n        this.update = function( table ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n\n            var records = [];\n            for ( var i = 0 ; i < arguments.length - 1 ; i++ ) {\n                records[ i ] = arguments[ i + 1 ];\n            }\n\n            var transaction = db.transaction( table , transactionModes.readwrite ),\n                store = transaction.objectStore( table ),\n                keyPath = store.keyPath,\n                deferred = Deferred();\n\n            records.forEach( function ( record ) {\n                var req;\n                if ( record.item && record.key ) {\n                    var key = record.key;\n                    record = record.item;\n                    req = store.put( record , key );\n                } else {\n                    req = store.put( record );\n                }\n\n                req.onsuccess = function ( e ) {\n                    deferred.notify();\n                };\n            } );\n            \n            transaction.oncomplete = function () {\n                deferred.resolve( records , that );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( records , e );\n            };\n            transaction.onabort = function ( e ) {\n                deferred.reject( records , e );\n            };\n            return deferred.promise();\n        };\n        \n        this.remove = function ( table , key ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n            var transaction = db.transaction( table , transactionModes.readwrite ),\n                store = transaction.objectStore( table ),\n                deferred = Deferred();\n            \n            var req = store.delete( key );\n            transaction.oncomplete = function ( ) {\n                deferred.resolve( key );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( e );\n            };\n            return deferred.promise();\n        };\n\n        this.clear = function ( table ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n            var transaction = db.transaction( table , transactionModes.readwrite ),\n                store = transaction.objectStore( table ),\n                deferred = Deferred();\n\n            var req = store.clear();\n            transaction.oncomplete = function ( ) {\n                deferred.resolve( );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( e );\n            };\n            return deferred.promise();\n        };\n        \n        this.close = function ( ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n            db.close();\n            closed = true;\n            delete dbCache[ name ];\n        };\n\n        this.get = function ( table , id ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n            var transaction = db.transaction( table ),\n                store = transaction.objectStore( table ),\n                deferred = Deferred();\n\n            var req = store.get( id );\n            req.onsuccess = function ( e ) {\n                deferred.resolve( e.target.result );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( e );\n            };\n            return deferred.promise();\n        };\n\n        this.query = function ( table , index ) {\n            if ( closed ) {\n                throw 'Database has been closed';\n            }\n            return new IndexQuery( table , db , index );\n        };\n\n        for ( var i = 0 , il = db.objectStoreNames.length ; i < il ; i++ ) {\n            (function ( storeName ) {\n                that[ storeName ] = { };\n                for ( var i in that ) {\n                    if ( !hasOwn.call( that , i ) || i === 'close' ) {\n                        continue;\n                    }\n                    that[ storeName ][ i ] = (function ( i ) {\n                        return function () {\n                            var args = [ storeName ].concat( [].slice.call( arguments , 0 ) );\n                            return that[ i ].apply( that , args );\n                        };\n                    })( i );\n                }\n            })( db.objectStoreNames[ i ] );\n        }\n    };\n\n    var IndexQuery = function ( table , db , indexName ) {\n        var that = this;\n        var modifyObj = false;\n\n        var runQuery = function ( type, args , cursorType , direction, limitRange, filters , mapper ) {\n            var transaction = db.transaction( table, modifyObj ? transactionModes.readwrite : transactionModes.readonly ),\n                store = transaction.objectStore( table ),\n                index = indexName ? store.index( indexName ) : store,\n                keyRange = type ? IDBKeyRange[ type ].apply( null, args ) : null,\n                results = [],\n                deferred = Deferred(),\n                indexArgs = [ keyRange ],\n                limitRange = limitRange ? limitRange : null,\n                filters = filters ? filters : [],\n                counter = 0;\n\n            if ( cursorType !== 'count' ) {\n                indexArgs.push( direction || 'next' );\n            };\n\n            // create a function that will set in the modifyObj properties into\n            // the passed record.\n            var modifyKeys = modifyObj ? Object.keys(modifyObj) : false;\n            var modifyRecord = function(record) {\n                for(var i = 0; i < modifyKeys.length; i++) {\n                    var key = modifyKeys[i];\n                    var val = modifyObj[key];\n                    if(val instanceof Function) val = val(record);\n                    record[key] = val;\n                }\n                return record;\n            };\n\n            index[cursorType].apply( index , indexArgs ).onsuccess = function ( e ) {\n                var cursor = e.target.result;\n                if ( typeof cursor === typeof 0 ) {\n                    results = cursor;\n                } else if ( cursor ) {\n                  if ( limitRange !== null && limitRange[0] > counter) {\n                      counter = limitRange[0];\n                      cursor.advance(limitRange[0]);\n                    } else if ( limitRange !== null && counter >= (limitRange[0] + limitRange[1]) ) {\n                        //out of limit range... skip\n                    } else {\n                        var matchFilter = true;\n                        var result = 'value' in cursor ? cursor.value : cursor.key;\n\n                        filters.forEach( function ( filter ) {\n                            if ( !filter || !filter.length ) {\n                                //Invalid filter do nothing\n                            } else if ( filter.length === 2 ) {\n                                matchFilter = (result[filter[0]] === filter[1])\n                            } else {\n                                matchFilter = filter[0].apply(undefined,[result]);\n                            }\n                        });\n\n                        if (matchFilter) {\n                            counter++;\n                            results.push( mapper(result) );\n                            // if we're doing a modify, run it now\n                            if(modifyObj) {\n                                result = modifyRecord(result);\n                                cursor.update(result);\n                            }\n                        }\n                        cursor.continue();\n                    }\n                }\n            };\n\n            transaction.oncomplete = function () {\n                deferred.resolve( results );\n            };\n            transaction.onerror = function ( e ) {\n                deferred.reject( e );\n            };\n            transaction.onabort = function ( e ) {\n                deferred.reject( e );\n            };\n            return deferred.promise();\n        };\n\n        var Query = function ( type , args ) {\n            var direction = 'next',\n                cursorType = 'openCursor',\n                filters = [],\n                limitRange = null,\n                mapper = defaultMapper,\n                unique = false;\n\n            var execute = function () {\n                return runQuery( type , args , cursorType , unique ? direction + 'unique' : direction, limitRange, filters , mapper );\n            };\n\n            var limit = function () {\n                limitRange = Array.prototype.slice.call( arguments , 0 , 2 )\n                if (limitRange.length == 1) {\n                    limitRange.unshift(0)\n                }\n\n                return {\n                    execute: execute\n                };\n            };\n            var count = function () {\n                direction = null;\n                cursorType = 'count';\n\n                return {\n                    execute: execute\n                };\n            };\n            var keys = function () {\n                cursorType = 'openKeyCursor';\n\n                return {\n                    desc: desc,\n                    execute: execute,\n                    filter: filter,\n                    distinct: distinct,\n                    map: map\n                };\n            };\n            var filter = function ( ) {\n                filters.push( Array.prototype.slice.call( arguments , 0 , 2 ) );\n\n                return {\n                    keys: keys,\n                    execute: execute,\n                    filter: filter,\n                    desc: desc,\n                    distinct: distinct,\n                    modify: modify,\n                    limit: limit,\n                    map: map\n                };\n            };\n            var desc = function () {\n                direction = 'prev';\n\n                return {\n                    keys: keys,\n                    execute: execute,\n                    filter: filter,\n                    distinct: distinct,\n                    modify: modify,\n                    map: map\n                };\n            };\n            var distinct = function () {\n                unique = true;\n                return {\n                    keys: keys,\n                    count: count,\n                    execute: execute,\n                    filter: filter,\n                    desc: desc,\n                    modify: modify,\n                    map: map\n                };\n            };\n            var modify = function(update) {\n                modifyObj = update;\n                return {\n                    execute: execute\n                };\n            };\n            var map = function (fn) {\n                mapper = fn;\n\n                return {\n                    execute: execute,\n                    count: count,\n                    keys: keys,\n                    filter: filter,\n                    desc: desc,\n                    distinct: distinct,\n                    modify: modify,\n                    limit: limit,\n                    map: map\n                };\n            };\n\n            return {\n                execute: execute,\n                count: count,\n                keys: keys,\n                filter: filter,\n                desc: desc,\n                distinct: distinct,\n                modify: modify,\n                limit: limit,\n                map: map\n            };\n        };\n        \n        'only bound upperBound lowerBound'.split(' ').forEach(function (name) {\n            that[name] = function () {\n                return new Query( name , arguments );\n            };\n        });\n\n        this.filter = function () {\n            var query = new Query( null , null );\n            return query.filter.apply( query , arguments );\n        };\n\n        this.all = function () {\n            return this.filter();\n        };\n    };\n    \n    var createSchema = function ( e , schema , db ) {\n        if ( typeof schema === 'function' ) {\n            schema = schema();\n        }\n        \n        for ( var tableName in schema ) {\n            var table = schema[ tableName ];\n            var store;\n            if (!hasOwn.call(schema, tableName) || db.objectStoreNames.contains(tableName)) {\n                store = e.currentTarget.transaction.objectStore(tableName);\n            } else {\n                store = db.createObjectStore(tableName, table.key);\n            }\n\n            for ( var indexKey in table.indexes ) {\n                var index = table.indexes[ indexKey ];\n                store.createIndex( indexKey , index.key || indexKey , Object.keys(index).length ? index : { unique: false } );\n            }\n        }\n    };\n    \n    var open = function ( e , server , version , schema ) {\n        var db = e.target.result;\n        var s = new Server( db , server );\n        var upgrade;\n\n        var deferred = Deferred();\n        deferred.resolve( s );\n        dbCache[ server ] = db;\n\n        return deferred.promise();\n    };\n\n    var dbCache = {};\n\n    var db = {\n        version: '0.9.0',\n        open: function ( options ) {\n            var request;\n\n            var deferred = Deferred();\n\n            // Check if we already have it in cache\n            var serverCache = dbCache[options.server];\n\n            if (serverCache) {\n                // If it is already in cache, make sure that we also \n                // have all of the tables we are opening already\n\n                for (var table in options.schema) {\n                    if (!serverCache.objectStoreNames.contains(table)) {\n                        serverCache.close();\n                        delete dbCache[options.server];\n                    }\n                }\n            }\n             \n\n            if ( dbCache[ options.server ]) {\n                open( {\n                    target: {\n                        result: dbCache[ options.server ]\n                    }\n                } , options.server , options.version , options.schema )\n                .done(deferred.resolve)\n                .fail(deferred.reject)\n                .progress(deferred.notify);\n            } else {\n                request = indexedDB.open( options.server , options.version );\n                            \n                request.onsuccess = function ( e ) {\n                    open( e , options.server , options.version , options.schema )\n                        .done(deferred.resolve)\n                        .fail(deferred.reject)\n                        .progress(deferred.notify);\n                };\n            \n                request.onupgradeneeded = function ( e ) {\n                    createSchema( e , options.schema , e.target.result );\n                };\n                request.onerror = function ( e ) {\n                    deferred.reject( e );\n                };\n            }\n\n            return deferred.promise();\n        }\n    };\n\n    return db;\n});",
    "\ndefine('dataBacking/indexedDBBacking',[\"dataBacking/baseBacking\", \"db\"], function(BaseBacking, db) {\n  var IndexedDBBacking = BaseBacking.extend({\n    _server: null,\n    _files: null,\n\n    // If we call other functions before the database is opened, \n    //these are the things we need to run\n    _initCallbacks: null,\n\n    init: function() {\n      console.log(\"backing file used\");\n      this._files = [];\n\n      this._initCallbacks = [];\n\n      db.open({\n        server: 'draw',\n        version: 1,\n        schema: {\n          files: {\n            key: {\n              keyPath: 'id',\n            },\n            indexes: {\n              id: {\n                unique: true\n              },\n              modifiedTime: {\n                //keyPath: 'modifiedTime'\n              }\n            }\n          }\n        }\n      })\n        .done((function(server) {\n          console.log(\"Set up files server\");\n          this._server = server;\n\n          // Go through all our delayed callbacks\n          for (var i = 0; i < this._initCallbacks.length; i++) {\n            var callback = this._initCallbacks[i];\n            callback.func.apply(this, callback.args);\n          }\n\n        }).bind(this))\n        .fail(function(e) {\n          console.error(\"Failed setting up database\", e);\n        });\n    },\n\n    getFiles: function(callback) {\n      if (!this._server) {\n        this._doLater(this.getFiles, [callback]);\n        return;\n      }\n\n      if (!callback) {\n        throw \"You must specify a callback\";\n      }\n\n      this._server.files.query('modifiedTime')\n        .all()\n        .desc()\n        .execute()\n        .done((function(results) {\n          callback(results);\n        }).bind(this));\n    },\n\n    _getFileServer: function(fileId, callback) {\n      if (this._files[fileId]) {\n        callback(this._files[fileId]);\n      } else {\n        db.open({\n          server: fileId,\n          version: 1,\n          schema: {\n            actions: {\n              key: {\n                keyPath: 'id',\n                autoIncrement: true\n              }\n              /*,\n            indexes: {\n              type: {},\n              id: {\n                unique: true\n              }\n            }\n            */\n            }\n          }\n        }).done((function(s) {\n          this._files[fileId] = s;\n\n          callback(s);\n        }).bind(this))\n          .fail(function(e) {\n            console.error(\"Failed to create file database\", e);\n          });\n      }\n    },\n\n    getFileActions: function(fileId, callback) {\n      if (!this._server) {\n        this._doLater(this.getFileActions, [fileId, callback]);\n        return;\n      }\n\n      this._getFileServer(fileId, (function(server) {\n        server.actions.query()\n          .all()\n          .execute()\n          .done((function(results) {\n            callback(results);\n          }).bind(this));\n      }).bind(this));\n    },\n\n    createFile: function(callback) {\n      if (!this._server) {\n        this._doLater(this.createFile, [callback]);\n        return;\n      }\n\n      if (!callback) {\n        throw \"You must specify a callback\";\n      }\n\n      var fileId = this._getGuid();\n\n      var file = {\n        id: fileId,\n        name: \"Untitled File\",\n        modifiedTime: Date.now()\n      }\n\n      this._server.files.add(file)\n        .done((function(items) {\n          var item = items[0];\n\n          this._getFileServer(item.id, (function(s) {\n            callback(item);\n          }).bind(this));\n\n        }).bind(this))\n        .fail(function(e) {\n          console.error(\"fail to add file to file list\", e);\n        });\n    },\n\n    renameFile: function(fileId, newFileName) {\n      if (!this._server) {\n        this._doLater(this.renameFile, [fileId]);\n        return;\n      }\n\n      this._server.files.query('id')\n        .only(fileId)\n        .modify({\n          name: newFileName\n        })\n        .execute()\n        .done(function(results) {\n          console.log(\"Want to rename file\", results);\n        })\n        .fail(function(e) {\n          console.error(\"Couldn't find file\", e);\n        })\n    },\n\n    deleteFile: function(fileId) {\n      if (!this._server) {\n        this._doLater(this.deleteFile, [fileId]);\n        return;\n      }\n\n      this._server.files.remove(fileId)\n        .done(function(key) {\n          // item removed\n          console.log(\"Deleted file from file table\", fileId);\n\n          var f = indexedDB.deleteDatabase(fileId);\n          f.onsuccess = function(e) {\n            console.log(\"Deleted Database for file\", key);\n          }\n          f.onerror = function(e) {\n            console.log(\"Error deleting database\", e);\n          }\n\n          // Delete settings from local storage\n          delete localStorage[fileId];\n\n        })\n        .fail(function(e) {\n          console.error(\"Failed to delete file from file table\", fileId);\n        });\n    },\n\n    addAction: function(fileId, action) {\n      console.log(\"Saving action\", action);\n      this._getFileServer(fileId, (function(server) {\n        server.actions\n          .add(action)\n          .done(function(item) {\n            console.log(\"After save\", action, item);\n            // item stored\n          })\n          .fail(function(e) {\n            console.error(\"fail to write\", e);\n          });\n      }).bind(this));\n    },\n\n    removeAction: function(fileId, actionIndex) {\n      \n      this._getFileServer(fileId, (function(server) {\n        server.actions\n          .remove(actionIndex)\n          .done(function(key) {\n\n            // item removed\n          });\n      }).bind(this));\n      \n    },\n\n    updateFileModified: function(fileId, timestamp) {\n      if (!this._server) {\n        this._doLater(this.updateFileModified, [fileId, timestamp]);\n        return;\n      }\n\n      this._server.files.query('id')\n        .only(fileId)\n        .modify({\n          modifiedTime: timestamp\n        })\n        .execute()\n        .done(function(results) {})\n        .fail(function(e) {\n          console.error(\"Couldn't find file\", e);\n        });\n    },\n\n    clearAll: function() {\n      this.getFiles((function(files) {\n        for (var i = 0; i < files.length; i++) {\n          this.deleteFile(files[i].id);\n        }\n      }).bind(this));\n    },\n\n    _doLater: function(func, args) {\n      this._initCallbacks.push({\n        func: func,\n        args: args\n      })\n    },\n  });\n\n  return IndexedDBBacking;\n});",
    "\ndefine('dataBacking/webSQLBacking',[\"dataBacking/baseBacking\"], function(BaseBacking) {\n  var WebSQLBacking = BaseBacking.extend({\n    _db: null,\n\n    init: function() {\n      console.log(\"sql init\");\n      this._error = this._error.bind(this);\n      this._db = openDatabase(\"draw\", \"1.0\", \"draw\", 2 * 1024 * 1024, this._databaseCreated.bind(this));\n    },\n\n    getFiles: function(callback) {\n      this._db.readTransaction((function(tx) {\n        tx.executeSql('SELECT * FROM `files` ORDER BY modifiedTime DESC', [], (function(transaction, results) {\n          var resultsObj = this._convertResultToObject(results);\n          callback(resultsObj);\n        }).bind(this));\n      }).bind(this));\n\n    },\n\n    getFileActions: function(fileId, callback) {\n      this._db.readTransaction((function(tx) {\n        tx.executeSql('SELECT * FROM `'+fileId+'`', [], (function(transaction, results) {\n          var resultsObj = this._convertResultToObject(results, [\"value\"]);\n          callback(resultsObj);\n        }).bind(this));\n      }).bind(this));\n    },\n\n    createFile: function(callback) {\n      var fileId = this._getGuid();\n\n      this._db.transaction(function(tx) {\n\n        // You can't seem to use prepared statement variables as the table name\n        tx.executeSql('CREATE TABLE IF NOT EXISTS `' + fileId + '` ' +\n          '(id INTEGER PRIMARY KEY, type VARCHAR(255), value TEXT)', []);\n\n        var file = {\n          id: fileId,\n          name: \"Untitled File\",\n          modifiedTime: Date.now()\n        }\n\n        tx.executeSql('INSERT INTO `files` VALUES (?, ?, ?)', [file.id, file.name, file.modifiedTime], this._success, this._error);\n\n        callback(file);\n      });\n    },\n\n    renameFile: function(fileId, newFileName) {\n      this._db.transaction(function(tx) {\n        tx.executeSql('UPDATE `files` SET name = ? WHERE id = ?', [newFileName, fileId], this._success, this._error);\n      });\n    },\n\n    deleteFile: function(fileId) {\n      this._db.transaction(function(tx) {\n        tx.executeSql('DELETE FROM `files` WHERE id = ?', [fileId], this._success, this._error);\n\n        tx.executeSql('DROP TABLE `'+fileId+'`', [], this._success, this._error);\n      });\n    },\n\n    addAction: function(fileId, action) {\n      this._db.transaction(function(tx) {\n        tx.executeSql('INSERT INTO `'+fileId+'` (id, type, value) VALUES (?, ?, ?)', [action.id, action.type, JSON.stringify(action.value)], this._success, this._error);\n      });\n    },\n\n    removeAction: function(fileId, actionIndex) {\n      \n      this._db.transaction(function(tx) {\n        tx.executeSql('DELETE FROM `'+fileId+'` WHERE id = ?', [actionIndex], this._success, this._error);\n      });\n    },\n\n    updateFileModified: function(fileId, timestamp) {\n      this._db.transaction(function(tx) {\n        tx.executeSql('UPDATE `files` SET modifiedTime = ? WHERE id = ?', [timestamp, fileId], this._success, this._error);\n      });\n    },\n\n    clearAll: function() {\n      this.getFiles((function(files) {\n        for (var i = 0; i < files.length; i++) {\n          this.deleteFile(files[i].id);\n        }\n      }).bind(this));\n    },\n\n    // The database was created, set up the tables\n    _databaseCreated: function(db) {\n      this._db.transaction(function(tx) {\n        tx.executeSql('CREATE TABLE IF NOT EXISTS files ' +\n          '(id VARCHAR(255) PRIMARY KEY, name VARCHAR(255), modifiedTime INTEGER)');\n      });\n    },\n\n    // JSON Decode should be an array of columns that have JSON that should be parsed\n    _convertResultToObject: function(results, JSONDecode) {\n      var rows = results.rows;\n      var objArray = new Array(rows.length);\n\n      for (var i = 0; i < rows.length; i++) {\n        var item = rows.item(i);\n\n        var newObj = {};\n        objArray[i] = newObj;\n\n        for (var prop in item) {\n          newObj[prop] = item[prop];\n        }\n\n        if (JSONDecode) {\n          for (var j = 0; j < JSONDecode.length; j++) {\n            // If this key exists on the object\n            var value = objArray[i][JSONDecode[j]];\n            if (value) {\n              // Replace it with a JSON Parsed version\n              var obj = JSON.parse(value);\n              objArray[i][JSONDecode[j]] = obj;\n            }\n          }\n        }\n\n      }\n\n      return objArray;\n    },\n\n    _success: function(e) {\n      console.log(\"Query Success\", e);\n    },\n\n    _error: function(e) {\n      console.error(\"Error with WebSQL\", e);\n    }\n\n\n  });\n\n  return WebSQLBacking;\n});",
    "\n/*\nTODO:\n  Make data.js have the same functions \n*/\n\ndefine('data',[\"class\", \"dataBacking/indexedDBBacking\", \"dataBacking/webSQLBacking\", \"event\"], function(Class, IndexedDBBacking, WebSQLBacking, Event) {\n  var Data = Class.extend({\n    _backing: null,\n\n    init: function() {\n      var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.oIndexedDB || window.msIndexedDB;\n      \n      if (indexedDB) {\n        console.log(\"Using IndexedDB as data store\");\n        this._backing = new IndexedDBBacking();  \n      }\n      else\n      {\n        console.log(\"Using WebSQL as data store\");\n        this._backing = new WebSQLBacking();\n      }\n      \n\n      Event.addListener(\"fileModified\", this._fileModified.bind(this));\n    },\n\n    // Get the name of all the files we have\n    getFiles: function(callback) {\n      this._backing.getFiles(callback);\n    },\n\n    getFileActions: function(fileId, callback) {\n      this._backing.getFileActions(fileId, callback);\n    },\n\n    // Create a new file and returns the file name\n    createFile: function(callback) {\n      this._backing.createFile(callback);\n    },\n\n    renameFile: function(fileId, newFileName) {\n      this._backing.renameFile(fileId, newFileName);\n    },\n\n    deleteFile: function(fileId) {\n      this._backing.deleteFile(fileId);\n    },\n\n    addAction: function(fileId, action) {\n      this._backing.addAction(fileId, action);\n    },\n\n    removeAction: function(fileId, actionIndex) {\n      this._backing.removeAction(fileId, actionIndex);\n    },\n\n    // Delete all the file rows, delete all the file databases,\n    // delete everything for files from local storage\n    clearAll: function() {\n      this._backing.clearAll();\n    },\n\n    _fileModified: function(data) {\n      this._backing.updateFileModified(data.fileId, data.timestamp);\n    },\n\n    // Get the stored file settings\n    localFileSettings: function(fileId, settings) {\n      if (settings) {\n        localStorage[fileId] = JSON.stringify(settings);\n      }\n\n      if (!localStorage[fileId]) {\n        localStorage[fileId] = JSON.stringify({\n          offsetX: 0,\n          offsetY: 0,\n          scale: 1\n        });\n      }\n\n      return JSON.parse(localStorage[fileId]);\n    },\n  });\n\n  var data = new Data();\n  window.data = data\n\n  return data;\n});",
    "\ndefine('templates/fileList',[], function() {\n\n  function FileList() {\n    var template = '<li class=\"file-info\">'+\n                      '<div class=\"thumbnail-wrapper\">'+\n                        '<canvas class=\"thumbnail\"></canvas>'+\n                      '</div>'+\n                      '<div class=\"file-details\">'+\n                        '<span class=\"file-name\"></span>'+\n                        '<span data-action=\"delete\">Delete</span>'+\n                      '</div>'+\n                    '</li';\n    var element = document.createElement(\"div\");\n    element.innerHTML = template;\n    return element.firstChild;\n  }\n\n  return FileList;\n});",
    "\ndefine('components/drawCanvas',[\"class\", \"helpers\"], function(Class, Helpers) {\n  var DrawCanvas = Class.extend({\n    _canvas: null,\n    _ctx: null,\n    _settings: null,\n\n    // Holds at most one action\n    _tempCanvas: null,\n    _tempCtx: null,\n\n    init: function(canvas, settings) {\n      this._canvas = canvas;\n      this._ctx = canvas.getContext(\"2d\");\n      this._settings = settings;\n\n      this._backCanvas = document.createElement(\"canvas\");\n      this._backCtx = this._backCanvas.getContext(\"2d\");\n\n      this._tempCanvas = document.createElement(\"canvas\");\n      this._tempCtx = this._tempCanvas.getContext(\"2d\");\n    },\n\n    // Creates a back canvas and draws all the actions to it and renders it on the main canvas\n    doAll: function(actions) {      \n      this._backCanvas.width = this._canvas.width;\n      this._backCanvas.height = this._canvas.height;\n\n      this._clearCanvas(this._backCanvas, this._backCtx);\n\n      // Also clear the temp canvas\n      this._clearCanvas(this._tempCanvas, this._tempCtx);\n\n      for (var i = 0; i < actions.length; i++) {\n        var action = actions[i];\n\n        this._doAction(this._backCtx, action);\n      }\n    },\n\n    // The action is done to a temporary canvas\n    doTemporaryAction: function(action) {\n      this._tempCanvas.width = this._canvas.width;\n      this._tempCanvas.height = this._canvas.height;\n\n      this._clearCanvas(this._tempCanvas, this._tempCtx);\n\n      this._doAction(this._tempCtx, action);\n    },\n\n    addAction: function(action) {\n      this._doAction(this._backCtx, action);\n\n      // Clears the temp canvas when you add something to the back\n      this._clearCanvas(this._tempCanvas, this._tempCtx);\n    },\n\n    _clearCanvas: function(canvas, ctx) {\n      ctx.setTransform(this._settings.scale, 0, 0, this._settings.scale, this._settings.offsetX, this._settings.offsetY);\n\n      var topLeft = Helpers.screenToWorld(this._settings, 0, 0);\n      var bottomRight = Helpers.screenToWorld(this._settings, canvas.width, canvas.height);\n\n      ctx.clearRect(topLeft.x, topLeft.y, bottomRight.x - topLeft.x, bottomRight.y - topLeft.y);\n    },\n\n    render: function() {\n      this._ctx.clearRect(0,0, this._canvas.width, this._canvas.height);\n      this._ctx.drawImage(this._backCanvas, 0, 0, this._backCanvas.width, this._backCanvas.height);\n      this._ctx.drawImage(this._tempCanvas, 0, 0, this._tempCanvas.width, this._tempCanvas.height);\n    },\n\n\n    _doAction: function(ctx, action) {\n      if (action.type == \"stroke\") {\n        this._drawStroke(ctx, action.value);\n      }\n    },\n\n    updateSettings: function(settings) {\n      this._settings = settings;\n    },\n\n    _drawStroke: function(ctx, stroke) {\n      if (stroke.points.length < 2) {\n        return;\n      }\n\n      var controlPoints = [];\n      var points = stroke.points;\n\n      if (!stroke.controlPoints) {\n        controlPoints = Helpers.getCurveControlPoints(points);\n      } else {\n        controlPoints = stroke.controlPoints;\n      }\n\n      var point = points[0];\n\n\n      var strokeSize = 1;\n      ctx.lineWidth = stroke.width / this._settings.scale;\n\n      ctx.beginPath();\n      ctx.moveTo(point.x, point.y);\n\n      for (var i = 1; i < points.length; i++) {\n        point = points[i];\n        var cp1 = controlPoints[i - 1].first;\n        var cp2 = controlPoints[i - 1].second;\n        ctx.bezierCurveTo(cp1.x, cp1.y, cp2.x, cp2.y, point.x, point.y);\n      }\n\n      ctx.stroke();\n    },\n  });\n\n  return DrawCanvas;\n\n  /*\n  drawAll(actions) // Draw all actions to a back canvas\n  drawTemporary(action) // draw action on front canvas\n  addAction(action) // add action to back canvas\n  */\n\n});",
    "\ndefine('components/manipulateCanvas',[\"components/drawCanvas\", \"helpers\"], function(DrawCanvas, Helpers) {\n\n  var ManipulateCanvas = DrawCanvas.extend({\n    zoom: function(x, y, dScale) {\n      // Can't zoom that far!\n      if (this._settings.scale + dScale < .001 || this._settings.scale + dScale > 20000) {\n        return false;\n      }\n\n      var world = Helpers.screenToWorld(this._settings, x, y);\n      this._settings.scale += dScale;\n      var scr = Helpers.worldToScreen(this._settings, world.x, world.y);\n\n      var diffScr = {\n        x: x - scr.x,\n        y: y - scr.y\n      };\n\n      this._settings.offsetX += diffScr.x; // * this._settings.scale;\n      this._settings.offsetY += diffScr.y; // * this._settings.scale;\n\n      return true;\n    },\n\n    pan: function(dx, dy) {\n      this._settings.offsetX += dx;\n      this._settings.offsetY += dy;\n\n      return true;\n    },\n\n    panTo: function(x, y) {\n      this._settings.offsetX = x;\n      this._settings.offsetY = y;\n    }\n  });\n\n  return ManipulateCanvas;\n});",
    "\ndefine('components/thumbnail',[\"class\", \"helpers\", \"data\", \"components/manipulateCanvas\"], function(Class, Helpers, Data, ManipulateCanvas) {\n\n  var Thumbnail = Class.extend({\n    _canvas: null,\n\n    init: function(canvas) {\n      this._canvas = canvas;\n    },\n\n    render: function(file) {\n      var fileInfo = file;\n\n      data.getFileActions(file.id, (function(actions) {\n        var settings = data.localFileSettings(file.id);\n\n        var manipulateCanvas = new ManipulateCanvas(this._canvas, settings);\n\n        // Find out what world point is in the middle\n        var centerScreen = {\n          x: window.innerWidth / 2,\n          y: window.innerHeight / 2\n        };\n        var centerWorld = Helpers.screenToWorld(settings, centerScreen.x, centerScreen.y);\n\n        var scale = Math.min(this._canvas.width / window.innerWidth, this._canvas.height / window.innerHeight);\n        var zoomDiff = (settings.scale * scale) - settings.scale;\n        manipulateCanvas.zoom(0, 0, zoomDiff);\n\n        // Now that we have zoomed, find the middle of the canvas\n        var centerScreenAfter = {\n          x: this._canvas.width / 2,\n          y: this._canvas.height / 2\n        };\n\n        // And where the middle point was from before\n        var centerScreenPointAfter = Helpers.worldToScreen(settings, centerWorld.x, centerWorld.y);\n\n        // pan the difference\n        var diffScreen = {\n          x: centerScreenAfter.x - centerScreenPointAfter.x,\n          y: centerScreenAfter.y - centerScreenPointAfter.y\n        };\n        manipulateCanvas.pan(diffScreen.x, diffScreen.y);\n\n        manipulateCanvas.doAll(actions);\n        manipulateCanvas.render();\n      }).bind(this));\n    }\n  });\n\n  return Thumbnail;\n});",
    "\ndefine('sections/fileList',[\"section\", \"tapHandler\", \"event\", \"helpers\", \"data\", \"templates/fileList\", \"components/thumbnail\"], function(Section, TapHandler, Event, Helpers, Data, FileListTemplate, Thumbnail) {\n\n  var FileList = Section.extend({\n    id: \"files-list-container\",\n\n    // The parent pane for this page\n    _filesPane: null,\n\n    // The element\n    _fileListElement: null,\n\n    // The set of files we are displaying on the page\n    // fileId => info\n    _files: null,\n\n    // Th order the files appear on the page\n    // index => fileId\n    _fileOrder: null,\n\n    _resizeTimeout: null,\n\n    init: function(filesPane) {\n      this._super();\n\n      this._filesPane = filesPane;\n\n      this._fileListElement = document.getElementById(\"files-list\");\n      this._files = {};\n      this._fileOrder = [];\n\n      this._resizeAndRender = this._resizeAndRender.bind(this);\n      this._actuallyResizeAndRender = this._actuallyResizeAndRender.bind(this);\n\n      Data.getFiles((function(files) {\n\n        console.log(\"got files\", files);\n\n        for (var i = 0; i < files.length; i++) {\n          var file = files[i];\n          this._files[file.id] = file;\n          this._fileOrder[i] = file.id;\n          var fileTemplate = this._newFileWrapper(file);\n          this._fileListElement.appendChild(fileTemplate);\n        }\n\n        this._actuallyResizeAndRender();\n      }).bind(this));\n\n      new TapHandler(document.getElementById(\"file-create\"), {\n        tap: this._newDoc.bind(this)\n      });\n\n      new TapHandler(this._fileListElement, {\n        tap: this._docSelected.bind(this)\n      });\n\n      Event.addListener(\"fileModified\", this._fileModified.bind(this));\n      Event.addListener(\"fileRenamed\", this._fileRenamed.bind(this));\n    },\n\n    show: function(fileInfo) {\n      if (fileInfo) {\n        // We came from draw, it is the info of the file we were just looking at\n        var file = this._files[fileInfo.id];\n        if (!file) {\n          console.error(\"We somehow came from a file that doesn't exist\");\n        }\n\n        file.thumbnail.render(file.file);\n      }\n\n      window.addEventListener(\"resize\", this._resizeAndRender);\n    },\n\n    hide: function() {\n      window.removeEventListener(\"resize\", this._resizeAndRender);\n    },\n\n    _newFileWrapper: function(file) {\n      var newEle = new FileListTemplate();\n\n      var canvas = newEle.getElementsByClassName(\"thumbnail\")[0];\n      var fileName = newEle.getElementsByClassName(\"file-name\")[0];\n\n      var thumbnail = new Thumbnail(canvas);\n      fileName.innerText = file.name;\n\n      newEle.fileId = file.id;\n\n      this._files[file.id] = {\n        element: newEle,\n        file: file,\n        canvas: canvas,\n        thumbnail: thumbnail\n      };\n\n      return newEle;\n    },\n\n    // Resize every thumbnail canvas and re-render them\n    _resizeAndRender: function() {\n      if (this._resizeTimeout) {\n        clearTimeout(this._resizeTimeout);\n      }\n\n      this._resizeTimeout = setTimeout(this._actuallyResizeAndRender.bind(this), 500);\n    },\n\n    _actuallyResizeAndRender: function() {\n      for (var fileId in this._files) {\n        var file = this._files[fileId];\n\n        var canvasParent = file.canvas.parentElement;\n        file.canvas.width = canvasParent.offsetWidth;\n        file.canvas.height = canvasParent.offsetHeight;\n        file.thumbnail.render(file.file);\n      }\n    },\n\n    _newDoc: function() {\n      console.log(\"new doc\");\n      data.createFile((function(file) {\n        var fileTemplate = this._newFileWrapper(file);\n        this._fileOrder.unshift(file.id);\n        this._fileListElement.insertBefore(fileTemplate, this._fileListElement.children[0]);\n      }).bind(this));\n    },\n\n    _docSelected: function(e) {\n      var element = e.srcElement;\n      var parent = Helpers.parentEleWithClassname(e.srcElement, \"file-info\");\n\n      if (parent) {\n        if (element.dataset.action && element.dataset.action == \"delete\") {\n\n          var file = this._files[parent.fileId];\n          this._fileListElement.removeChild(file.element);\n          delete this._files[parent.fileId];\n          data.deleteFile(parent.fileId);\n\n          // delete file\n          return;\n        }\n\n        this._filesPane.setPane(\"draw\", this._files[parent.fileId].file);\n      }\n\n    },\n\n    _fileModified: function(data) {\n      var index = this._fileOrder.indexOf(data.fileId);\n\n      // Move every element up\n      for (var i = index; i < this._files.length - 1; i++) {\n        this._fileOrder[i] = this._fileOrder[i+1];\n      }\n\n      // Change the length to get rid of the last element\n      this._fileOrder.length = this._fileOrder.length - 1;\n\n      // Put this one at the beginning\n      this._fileOrder.unshift(data.fileId);\n\n      // Now actually take the element out and put it at the beginning too\n      var element = this._files[data.fileId].element;\n      this._fileListElement.removeChild(element);\n      this._fileListElement.insertBefore(element, this._fileListElement.children[0]);\n    },\n\n    _fileRenamed: function(data) {\n      console.log(\"File renamed\", data);\n\n      this._files[data.fileId].name = data.name;\n      var element = this._files[data.fileId].element;\n      var fileNameElement = element.getElementsByClassName(\"file-name\")[0];\n      fileNameElement.innerText = data.name;\n    }\n\n  });\n\n  return FileList;\n\n});",
    "\ndefine('sections/draw',[\"section\", \"globals\", \"event\", \"helpers\", \"tapHandler\", \"db\", \"data\", \"components/manipulateCanvas\"], function(Section, g, Event, Helpers, TapHandler, db, Data, ManipulateCanvas) {\n\n  var Draw = Section.extend({\n    id: \"draw\",\n\n    // The parent pane for this page\n    _filesPane: null,\n\n    // Instance of draw canvas that is handling all the drawing\n    _manipulateCanvas: null,\n\n    // The actual canvas element\n    _canvas: null,\n\n    // The file we are currently rendering\n    _fileInfo: null,\n\n    // Local settings such as offset and zoom\n    _settings: null,\n\n    // The actions we are taking\n    _actions: null,\n\n    // If we are currently doing something like drawing, it will be here\n    _currentAction: null,\n\n    // Do we need to update on this frame?\n    _updateAll: true,\n\n    // Does the current action need to be redrawn?\n    _updateCurrentAction: false,\n\n    // Set this to false to stop the render loop\n    _shouldRender: false,\n\n    // The current tool, zoom or pan\n    _currentTool: \"pan\",\n\n    // When you move the mouse, what is the tool to use?\n    _currentPointTool: \"pencil\",\n\n    _currentPencilColor: \"#000000\",\n\n    // Timeout for \n    _saveTransformTimeout: null,\n\n    _redoStack: null,\n\n    // The tap handler for the draw pane. Needed to turn on and off gestures\n    _canvasTapHandler: null,\n\n    _toolTapHandler: null,\n\n    _fileNameElement: null,\n\n    // The overlay of modals\n    _overlay: null,\n\n    init: function(filesPane) {\n      this._super();\n\n      this._filesPane = filesPane;\n\n      this._canvas = document.getElementById('canvas');\n\n      this._resize = this._resize.bind(this);\n\n      // Keep the trackpad from trigger chrome's back event\n      this.element.addEventListener(\"touchmove\", function(e) {\n        e.preventDefault();\n      });\n\n      this._canvasTapHandler = new TapHandler(canvas, {\n        start: this._start.bind(this),\n        move: this._move.bind(this),\n        end: this._end.bind(this),\n        gesture: this._gesture.bind(this)\n      });\n\n\n      this._toolTapHandler = new TapHandler(document.getElementById(\"tools\"), {\n        tap: this._toolChanged.bind(this),\n        start: this._toolStart.bind(this),\n        end: this._toolEnd.bind(this)\n      });\n\n      new TapHandler(document.getElementById(\"menu\"), {\n        tap: this._menuTapped.bind(this),\n      });\n\n      new TapHandler(document.getElementById(\"colorPicker\"), {\n        tap: this._colorPicked.bind(this)\n      });\n\n      this._overlay = document.getElementById(\"draw-overlay\");\n      this._overlay.addEventListener(\"mousedown\", this._hideModal.bind(this));\n      this._overlay.addEventListener(\"touchstart\", this._hideModal.bind(this));\n\n      this.element.addEventListener(\"mousewheel\", this._mouseWheel.bind(this));\n      this.element.addEventListener(\"keydown\", this._keyDown.bind(this));\n\n      this._fileNameElement = document.getElementById(\"fileName\");\n      this._fileNameElement.addEventListener(\"keydown\", this._fileNameKeyDown.bind(this));\n      this._fileNameElement.addEventListener(\"blur\", this._fileNameBlur.bind(this));\n    },\n\n    show: function(file) {\n      this._fileInfo = file;\n\n      this._actions = [];\n      this._redoStack = [];\n\n      console.log(\"draw shown for file\", file);\n\n      this._fileNameElement.innerText = this._fileInfo.name;\n\n      data.getFileActions(file.id, (function(results) {\n        this._actions = results;\n        this._updateAll = true;\n\n        this._settings = data.localFileSettings(file.id);\n\n        this._manipulateCanvas = new ManipulateCanvas(this._canvas, this._settings);\n\n        this._shouldRender = true;\n        this._redraw();\n      }).bind(this));\n\n      // We don't need data to resize\n      this._resize();\n\n\n\n      // Focus on the canvas after we navigate to it\n      setTimeout(function() {\n        canvas.focus();\n      }.bind(this), 400);\n\n      window.addEventListener(\"resize\", this._resize);\n    },\n\n    hide: function() {\n      this._shouldRender = false;\n\n      window.removeEventListener(\"resize\", this._resize);\n    },\n\n    _resize: function() {\n      this._canvas.width = window.innerWidth;\n      this._canvas.height = window.innerHeight;\n\n      this._updateAll = true;\n    },\n\n    _zoom: function(x, y, dScale) {\n      if (this._manipulateCanvas.zoom(x, y, dScale)) {\n        this._saveTransform();\n        this._updateAll = true;\n      }\n    },\n\n    _pan: function(dx, dy) {\n      if (this._manipulateCanvas.pan(dx, dy)) {\n        this._saveTransform();\n        this._updateAll = true;\n      }\n    },\n\n    _mouseWheel: function(e) {\n\n      if (this._currentTool == \"pan\") {\n        this._pan(-e.deltaX, -e.deltaY);\n      } else if (this._currentTool == \"zoom\") {\n        if (e.deltaY != 0) {\n          //console.log(e);\n          this._zoom(e.offsetX, e.offsetY, e.deltaY / 100 * this._settings.scale);\n        }\n      }\n    },\n\n    _start: function(e) {\n      if (this._currentPointTool == \"pan\") {\n\n      } else if (this._currentPointTool == \"pencil\") {\n        var world = Helpers.screenToWorld(this._settings, e.distFromLeft, e.distFromTop);\n\n        if (this._currentAction) {\n          console.error(\"Current action isn't null!\");\n        }\n\n        this._currentAction = {\n          type: \"stroke\",\n          value: {\n            points: [world],\n            width: 2,\n            color: this._currentPencilColor\n          }\n        }\n\n        // Make sure the redo stack is empty as we are starting to draw again\n        this._redoStack = [];\n      }\n    },\n\n    _move: function(e) {\n      if (this._currentPointTool == \"pan\") {\n        // Make sure there are two touches\n        if (e.touches.length == 1) {\n          return;\n        }\n\n        this._pan(e.xFromLast, e.yFromLast);\n      } else if (this._currentPointTool == \"pencil\") {\n\n        if (!this._currentAction) {\n          // no current action. This can happen if we were dragging a tool and let up the\n          // tool button and kept dragging\n          return;\n        }\n\n        var world = Helpers.screenToWorld(this._settings, e.distFromLeft, e.distFromTop);\n\n        //console.log(\"world\", e, world);\n        var currentStroke = this._currentAction.value;\n\n        var points = currentStroke.points;\n        var lastPoint = points[points.length - 1];\n\n\n        var dist = Math.sqrt(((lastPoint.x - world.x) * (lastPoint.x - world.x)) + ((lastPoint.y - world.y) * (lastPoint.y - world.y)));\n        //console.log(\"dist\", dist);\n\n        //if (dist < 0.0003) {\n        if (dist < 0.001) {\n          return;\n        }\n\n        currentStroke.points.push(world);\n        this._updateCurrentAction = true;\n      }\n    },\n\n    _end: function(e) {\n      if (this._currentPointTool == \"pencil\") {\n        if (!this._currentAction) {\n          // no current action. This can happen if we were dragging a tool and let up the\n          // tool button and kept dragging\n          return;\n        }\n\n        var currentAction = this._currentAction;\n        this._currentAction = null;\n\n        var currentStroke = currentAction.value;\n\n        if (currentStroke.points.length < 2) {\n          // two options, don't count the stroke\n          return;\n\n          // Or create a second point, same as the first.\n          // Canvas doesn't seem to render a line with two identical points.\n          currentStroke.points.push(currentStroke.points[0]);\n        }\n\n        var controlPoints = Helpers.getCurveControlPoints(currentStroke.points);\n        currentStroke.controlPoints = controlPoints;\n\n        this._updateCurrentAction = true;\n\n        this._saveAction(currentAction);\n      }\n    },\n\n    _saveAction: function(action) {\n      // The id for the action is the next one in the array\n      // But 1 based indexing\n      action.id = this._actions.length + 1;\n\n      this._actions.push(action);\n\n      this._manipulateCanvas.addAction(action);\n\n      // And persist it\n      data.addAction(this._fileInfo.id, action);\n\n      Event.trigger(\"fileModified\", {\n        fileId: this._fileInfo.id,\n        timestamp: Date.now()\n      });\n\n      this._updateAll = true;\n    },\n\n    _gesture: function(e) {\n      if (this._currentPointTool == \"pencil\") {\n        this._pan(e.xFromLast, e.yFromLast);\n        this._zoom(e.x, e.y, e.scaleFromLast * this._settings.scale);\n      }\n    },\n\n    _redraw: function() {\n      // If we shouldn't render, exit the loop\n      if (!this._shouldRender) {\n        return;\n      }\n\n      if (this._updateAll) {\n        this._manipulateCanvas.doAll(this._actions);\n\n      }\n\n      if (this._updateCurrentAction && this._currentAction) {\n        this._manipulateCanvas.doTemporaryAction(this._currentAction)\n\n      }\n\n      if (this._updateAll || this._updateCurrentAction) {\n        this._manipulateCanvas.render();\n\n        this._updateAll = false;\n        this._updateCurrentAction = false;\n      }\n\n      requestAnimationFrame(this._redraw.bind(this));\n    },\n\n    _menuTapped: function(e) {\n      if (e.srcElement.tagName == \"LI\") {\n        var action = e.srcElement.dataset.action;\n\n        if (action == \"back\") {\n          this._filesPane.setPane(\"list\", this._fileInfo);\n        } else if (action == \"rename\") {\n          e.srcElement.focus();\n        } else if (action == \"export\") {\n          var dataURL = this._canvas.toDataURL();\n          window.open(dataURL);\n        }\n      }\n    },\n\n    _toolChanged: function(e) {\n      var parent = Helpers.parentEleWithClassname(e.srcElement, \"toolitem\");\n\n      if (parent && parent.tagName == \"LI\") {\n        var action = parent.dataset.action;\n        var tool = parent.dataset.tool;\n\n        if (tool) {\n          this._currentTool = tool;\n        } else if (action) {\n          if (action == \"undo\") {\n            this._undo();\n          } else if (action == \"redo\") {\n            this._redo();\n          }\n          if (action == \"color\") {\n            this._showModal(\"colorPicker\");\n\n            e.preventDefault();\n            e.stopImmediatePropagation();\n          }\n        }\n      }\n    },\n\n    _showModal: function(modalId) {\n      var modal = document.getElementById(modalId);\n      if (!modal) {\n        console.error(\"No modal with that id\");\n        return;\n      }\n\n\n      this._overlay.currentModal = modalId;\n      this._overlay.style.display = \"block\";\n      modal.classList.add(\"visible\");\n      modal.style.left = window.innerWidth / 2 - modal.offsetWidth / 2 +\"px\";\n      modal.style.top = window.innerHeight / 2 - modal.offsetHeight / 2 +\"px\";\n    },\n\n    _hideModal: function(e) {\n      if (e && e.srcElement != this._overlay) {\n        // overlay was explicitly tapped\n        return;\n      }\n\n      if (this._overlay.currentModal) {\n        // A modal is showing\n        var modal = document.getElementById(this._overlay.currentModal);\n        modal.classList.remove(\"visible\");\n        this._overlay.currentModal = \"\";\n      }\n\n      this._overlay.style.display = \"\";\n\n      if (e) {\n        e.stopPropagation();\n      }\n    },\n\n    _colorPicked: function(e) {\n      console.log(\"color picked\");\n\n      parent = Helpers.parentEleWithClassname(e.srcElement, \"swatch\");\n      if (parent) {\n        var color = parent.style.backgroundColor;\n        this._currentPencilColor = color;\n\n        console.log(\"color\", color);\n        document.getElementById(\"chosenColorSwatch\").style.backgroundColor = color;\n        this._hideModal();\n      }\n\n      e.stopPropagation();\n    },\n\n    _toolStart: function(e) {\n      var tool = e.srcElement.dataset.tool;\n      var action = e.srcElement.dataset.action;\n\n      if (e.srcElement.tagName == \"LI\" && tool) {\n        this._currentPointTool = tool;\n\n        if (tool == \"pan\") {\n\n        }\n\n        this._canvasTapHandler.ignoreGestures(true);\n        this._toolTapHandler.ignoreGestures(true);\n      }\n    },\n\n    _toolEnd: function(e) {\n      if (e) {\n        var tool = e.srcElement.dataset.tool;\n\n        if (e.srcElement.tagName == \"LI\" && tool) {\n          if (tool == \"pan\") {\n\n          }\n\n          this._currentPointTool = \"pencil\";\n          this._canvasTapHandler.ignoreGestures(false);\n          this._toolTapHandler.ignoreGestures(false);\n        }\n      }\n    },\n\n    _keyDown: function(e) {\n      var key = String.fromCharCode(e.keyCode);\n      //console.log(e);\n      // console.log(\"key\", key);\n      // console.log(e);\n\n      if (\n        ((g.isMac() && e.metaKey && e.shiftKey) && key == \"Z\") ||\n        ((g.isPC() && e.ctrlKey) && key == \"Y\")) {\n        // Redo\n\n        if (this._redoStack.length > 0) {\n          this._redo();\n        }\n      } else if ((\n          (g.isMac() && e.metaKey) ||\n          (g.isPC() && e.ctrlKey)\n        ) &&\n        key == \"Z\") {\n        // Undo\n\n        e.preventDefault();\n        this._undo();\n      } else if (key == \"Z\") {\n        this._currentTool = \"zoom\";\n      } else if (key == \"P\") {\n        this._currentTool = \"pan\";\n      }\n\n    },\n\n    _undo: function() {\n      if (this._actions.length > 0) {\n        console.log(\"undo\");\n        var action = this._actions.pop();\n\n        // It is impossible to delete the id off of the action, so we have to create a new object\n        var newObj = {};\n\n        for (var prop in action) {\n          if (prop != \"id\") {\n            newObj[prop] = action[prop];\n          }\n        }\n\n\n        this._redoStack.push(newObj);\n\n        data.removeAction(this._fileInfo.id, action.id);\n        this._manipulateCanvas.doAll(this._actions);\n\n        this._updateAll = true;\n      }\n    },\n\n    _redo: function() {\n      if (this._redoStack.length > 0) {\n        console.log(\"redo\");\n        var nowAction = this._redoStack.pop();\n        this._saveAction(nowAction);\n      }\n    },\n\n    _fileNameKeyDown: function(e) {\n      if (e.keyCode == 13) { // Enter\n        this._fileNameElement.blur();\n      }\n    },\n\n    _fileNameBlur: function(e) {\n      var name = e.srcElement.innerText;\n      data.renameFile(this._fileInfo.id, name);\n\n      Event.trigger(\"fileRenamed\", {\n        fileId: this._fileInfo.id,\n        name: name\n      });\n    },\n\n\n    _saveTransform: function() {\n      // If the timeout is set already\n      if (this._saveTransformTimeout) {\n\n        // Clear it and set a new one\n        clearTimeout(this._saveTransformTimeout);\n      }\n\n      this._saveTransformTimeout = setTimeout((function() {\n        data.localFileSettings(this._fileInfo.id, this._settings);\n        this._saveTransformTimeout = null;\n      }).bind(this), 100);\n\n    },\n  });\n\n  return Draw;\n\n});",
    "\ndefine('managers/files',[\"section\", \"event\", \"sections/fileList\", \"sections/draw\"], function(Section, Event, FileList, Draw) {\n\n  var Files = Section.extend({\n    id: \"files\",\n\n    _paneWrapper: null,\n\n    _screenWidth: 0,\n\n    _defaultSettings: {},\n\n    panes: null,\n\n    currentPaneName: null,\n\n    init: function() {\n      this._super();\n\n      this._defaultSettings = {\n        title: {\n          text: \"Photos\"\n        }\n      };\n\n      this._screenWidth = window.innerWidth;\n\n      this._paneWrapper = document.getElementById(\"files-pane-wrapper\");\n\n      this._windowResized = this._windowResized.bind(this);\n      this._finishedSliding = this._finishedSliding.bind(this);\n\n      this._paneWrapper.addEventListener(\"webkitTransitionEnd\", this._finishedSliding);\n\n      this.panes = {};\n\n      this.panes.list = {\n        offsetX: 0,\n        pane: new FileList(this)\n      };\n\n      this.panes.draw = {\n        offsetX: this._screenWidth,\n        pane: new Draw(this)\n      };\n\n      this.panes.draw.pane.element.style.webkitTransform = 'translate3d(' + this._screenWidth + \"px, 0px, 0px)\";\n\n      var state = {\n        pane: \"list\",\n        details: null\n      };\n      if (localStorage.filesPane) {\n        state = JSON.parse(localStorage.filesPane);\n      }\n\n      this.setPane(state.pane, state.details);\n\n\n      window.files = this;\n    },\n\n    show: function() {\n      window.addEventListener(\"resize\", this._windowResized);\n    },\n\n    hide: function() {\n      window.removeEventListener(\"resize\", this._windowResized);\n    },\n\n    setPane: function(pane, details) {\n      if (this.currentPaneName == pane)\n        return;\n\n      var paneobj = null;\n\n      if (this.currentPaneName) {\n\n        var paneobj = this.panes[this.currentPaneName].pane;\n\n        if (paneobj.hide) {\n          paneobj.hide();\n        }\n\n        paneobj.afterHide();\n      }\n\n\n      paneobj = this.panes[pane].pane;\n\n      if (paneobj.show) {\n        paneobj.show(details);\n      }\n\n      paneobj.afterShow();\n\n      this.currentPaneName = pane;\n\n\n      // Finish up\n      var totalPane = this.panes[pane];\n\n      var translate = \"translate3d(\" + (-1 * totalPane.offsetX) + \"px, 0px, 0px)\";\n      if (this._paneWrapper.style.webkitTransform != translate) {\n        this._paneWrapper.classList.add(\"ani4\");\n        this._paneWrapper.style.webkitTransform = translate;\n      }\n\n\n      if (pane == \"list\") {\n        delete localStorage[\"filesPane\"];\n      } else {\n        localStorage.filesPane = JSON.stringify({\n          pane: pane,\n          details: details\n        });\n      }\n    },\n\n    _finishedSliding: function() {\n      // Remove the animation\n      this._paneWrapper.classList.remove(\"ani4\");\n\n      this._redoOffsets();\n\n      this._paneWrapper.style.webkitTransform = \"translate3d(0px, 0px, 0px)\";\n    },\n\n    _windowResized: function() {\n      this._redoOffsets();\n    },\n\n    _redoOffsets: function() {\n      window.current = this;\n\n      this._screenWidth = window.innerWidth;\n\n      // Set the offsets on all the panes so that the current pane is 0,0\n      var currentIndex = 0;\n      for (var pane in this.panes) {\n        if (this.currentPaneName == pane) {\n          break;\n        }\n\n        currentIndex++;\n\n      }\n\n      var startX = -1 * currentIndex * this._screenWidth;\n      for (var pane in this.panes) {\n        this.panes[pane].offsetX = startX;\n        this.panes[pane].pane.element.style.webkitTransform = 'translate3d(' + startX + \"px, 0px, 0px)\";\n        startX += this._screenWidth;\n      }\n    }\n  });\n\n  return Files;\n\n});",
    "\ndefine('sections/main',[\"section\", \"event\", \"managers/files\"], function(Section, Event, Files) {\n\n  var Main = Section.extend({\n    id: \"main-container\",\n\n    mainContent: null,\n\n    // The panes we slide between in the main-content\n    panes: null,\n    currentPane: \"\",\n\n\n    init: function() {\n      this._super();\n\n      this.mainContent = document.getElementById(\"main-content\");\n      this.panes = {};\n\n      this.panes.files = new Files();\n\n      Event.addListener(\"logout\", this._logout.bind(this));\n    },\n\n    show: function() {\n      console.log(\"screens shown\");\n\n      if (localStorage.currentPane) {\n        this.setPane(localStorage.currentPane);\n      } else {\n        this.setPane(\"files\");\n      }\n\n      //this.showDrawer();\n    },\n\n\n    setPane: function(pane) {\n      if (this.currentPane == pane)\n        return;\n\n      var paneobj = null;\n\n      if (this.currentPane) {\n\n        var paneobj = this.panes[this.currentPane];\n\n        if (paneobj.hide) {\n          paneobj.hide();\n        }\n\n        paneobj.afterHide();\n      }\n\n      paneobj = this.panes[pane];\n\n      if (paneobj.show) {\n        paneobj.show();\n      }\n\n      paneobj.afterShow();\n\n      this.currentPane = pane;\n\n      localStorage.currentPane = pane;\n      Event.trigger(\"paneChanged\", {\n        pane: paneobj\n      });\n    },\n\n    _logout: function() {\n      delete localStorage.currentPane;\n    }\n  });\n\n  return Main;\n\n});",
    "\ndefine('managers/login',[\"event\", \"sections/login\", \"sections/main\"], function(Event, LoginSection, MainSection) {\n  function LoginManager() {\n    this.init();\n  }\n\n  LoginManager.prototype = {\n    pages: null,\n    currentPage: \"\",\n\n    init: function() {\n      this.pages = {};\n\n      Event.addListener(\"login\", this._login.bind(this));\n      Event.addListener(\"logout\", this._logout.bind(this));\n\n      this.pages.login = new LoginSection();\n      this.pages.main = new MainSection();\n\n      if (localStorage.loggedIn == \"true\") {\n        this.setPage(\"main\");\n      }\n      else\n      {\n        this.setPage(\"login\");\n      }\n    },\n\n    setPage: function(page) {\n      var pageobj = null;\n\n      if (this.currentPage) {\n\n        var pageobj = this.pages[this.currentPage];\n\n        if (pageobj.hide) {\n          pageobj.hide();\n        }\n        pageobj.afterHide();\n      }\n\n      pageobj = this.pages[page];\n      \n      if (pageobj.show) {\n        pageobj.show();\n      }\n      pageobj.afterShow();\n\n      this.currentPage = page;\n    },\n\n    _login: function() {\n      localStorage.loggedIn = true;\n      this.setPage(\"main\");\n    },\n\n    _logout: function() {\n      localStorage.loggedIn = false;\n      this.setPage(\"login\");\n    }\n  };\n\n  return LoginManager;\n});",
    "\nrequire([\"event\", \"globals\", \"managers/login\"], function(Event, g, LoginManager) {\n\n  function init() {\n    window.log = console.log.bind(console);\n\n    window.addEventListener(\"mousewheel\", function(e) {\n      e.preventDefault();\n    });\n\n    g.setHTMLDevices();\n\n    var loginManager = new LoginManager();\n    window.login = loginManager;\n\n    window.addEventListener(\"resize\", function() {\n      // make sure we are scrolled to 0. Without this there are problems \n      // when changing device orientation\n      window.scroll(0,0);\n    })\n  }\n\n  if (document.readyState === \"interactive\" || document.readyState === \"complete\") {\n    init();\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", init, false);\n  }\n});\ndefine(\"main\", function(){});\n"
  ]
}